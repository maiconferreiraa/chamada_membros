<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chamada Maranata</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { background-color: #0b0b0b; color: white; padding-bottom: 80px; }
        .card-membro { background: #1a1a1a; border-left: 4px solid #0d6efd; margin-bottom: 10px; }
        .text-yellow { color: #ffca28; }
        .btn-presenca { background: #0d6efd; border: none; }
        .btn-falta { background: #ff4444; border: none; }
        .navbar-custom { border-bottom: 2px solid #ffca28; }
    </style>
</head>
<body>

<nav class="navbar navbar-dark bg-black sticky-top navbar-custom p-3">
    <div class="container-fluid">
        <span class="navbar-brand fw-bold">CHAMADA MARANATA</span>
        <button class="btn btn-outline-warning btn-sm" data-bs-toggle="modal" data-bs-target="#modalNovo">
            <i class="bi bi-person-plus"></i>
        </button>
    </div>
</nav>

<div class="container mt-3">
    <input type="text" id="busca" class="form-control bg-dark text-white border-secondary mb-3" placeholder="Buscar por nome ou função...">

    <div id="listaChamada">
        </div>
</div>

<div class="modal fade" id="modalNovo" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark border-primary">
            <div class="modal-header border-secondary">
                <h5 class="modal-title">Gerenciar Membro</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="text" id="nomeMembro" class="form-control mb-2" placeholder="Nome">
                <input type="text" id="funcoesMembro" class="form-control mb-2" placeholder="Funções (ex: Obreiro, Som)">
                <select id="catMembro" class="form-select mb-2">
                    <option value="Adulto">Adulto</option>
                    <option value="Jovem">Jovem</option>
                    <option value="Adolescente">Adolescente</option>
                </select>
                <button onclick="salvarMembro()" class="btn btn-primary w-100">Salvar no Firebase</button>
            </div>
        </div>
    </div>
</div>

<nav class="navbar fixed-bottom bg-black border-top border-secondary py-2">
    <div class="container d-flex justify-content-around">
        <a href="index.html" class="text-primary text-center text-decoration-none">
            <i class="bi bi-person-check fs-4"></i><br><small>Chamada</small>
        </a>
        <a href="relatorio.html" class="text-white-50 text-center text-decoration-none">
            <i class="bi bi-file-bar-graph fs-4"></i><br><small>Relatórios</small>
        </a>
    </div>
</nav>

<script type="module">
    // Aqui entra o firebaseConfig que você pegou no console do Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc, collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { /* COLE SEUS DADOS AQUI */ };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Função para Salvar/Editar
    window.salvarMembro = async () => {
        const nome = document.getElementById('nomeMembro').value.toUpperCase();
        const funcoes = document.getElementById('funcoesMembro').value.split(',').map(f => f.trim());
        const categoria = document.getElementById('catMembro').value;

        await setDoc(doc(db, "membros", nome), { nome, funcoes, categoria }, { merge: true });
        bootstrap.Modal.getInstance(document.getElementById('modalNovo')).hide();
    };

    // Renderizar Lista em Ordem Alfabética
    const q = query(collection(db, "membros"), orderBy("nome", "asc"));
    onSnapshot(q, (snapshot) => {
        const lista = document.getElementById('listaChamada');
        lista.innerHTML = '';
        snapshot.forEach(doc => {
            const m = doc.data();
            lista.innerHTML += `
                <div class="card card-membro p-3">
                    <div class="d-flex justify-content-between align-items-start">
                        <div onclick="abrirEdicao('${m.nome}', '${m.funcoes.join(',')}')">
                            <strong class="d-block">${m.nome}</strong>
                            <small class="text-yellow">${m.funcoes.join(' • ')}</small>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-presenca">P</button>
                            <button class="btn btn-sm btn-falta">F</button>
                        </div>
                    </div>
                </div>`;
        });
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>